---
import { tooltipOuterHiddenForSizeFullClass, tooltipSpaceAwayFromTriggerElementClass, tooltipOuterToDisplayClass, tooltipCalculationsTestingContainerClass } from './TooltipOverlay.consts';

interface Props {
    padding: string;
    margin: string;
    backgroundColor: string;
    borderWidth: string;
    borderColor: string;
    borderRadius?: string;
    spaceAwayFromTriggerElement: string;
    marginClosestToTriggerElementEnabled?: boolean;
    heightMaximum: string;
    widthMaximum: string;
    transition?: string;
    scrollFactorCalculationForChildrenPercentage?: number;
}
const {
    padding: tooltipPadding = '0.5rem',
    margin: tooltipMargin = '1rem',
    backgroundColor: tooltipBackgroundColor = '#FFFFFF',
    borderWidth: tooltipBorderWidth = '0.125rem',
    borderColor: tooltipBorderColor = '#000000',
    borderRadius: tooltipBorderRadius = '0.25rem',
    spaceAwayFromTriggerElement: tooltipSpaceAwayFromTriggerElement = '0.375rem',
    marginClosestToTriggerElementEnabled: tooltipMarginClosestToTriggerElementEnabled = false,
    heightMaximum: tooltipHeightMaximum = '10rem',
    widthMaximum: tooltipWidthMaximum = '40rem',
    transition: tooltipTransition = 'none',
    scrollFactorCalculationForChildrenPercentage: tooltipScrollFactorCalculationForChildrenPercentage = 100
} = Astro.props;
---

<div class="overlay-tooltip-inner" data-overlay-type="tooltip" data-tooltip-margin-closest-to-trigger-element-enabled={tooltipMarginClosestToTriggerElementEnabled ? 'true' : 'false'} data-tooltip-scroll-factor-calculation-for-children-percentage={tooltipScrollFactorCalculationForChildrenPercentage}>
    <div class={tooltipCalculationsTestingContainerClass}>
        <div class={tooltipSpaceAwayFromTriggerElementClass}></div>
        <div class={`tooltip-outer ${tooltipOuterHiddenForSizeFullClass}`}>
            <div class="tooltip">
                <slot />
            </div>
        </div>
    </div>
    <div class={`tooltip-outer ${tooltipOuterToDisplayClass}`} tabindex="0">
        <div class="tooltip" tabindex="0">
            <slot />
        </div>
    </div>
</div>

<script>
    import '/src/scripts/overlay-tooltip.ts';
</script>

<style is:global>
    .overlay-tooltip-inner .tooltip-outer {
        display: flex;
    }
</style>

<style define:vars={{ tooltipPadding, tooltipMargin, tooltipBackgroundColor, tooltipBorderWidth, tooltipBorderColor, tooltipBorderRadius, tooltipSpaceAwayFromTriggerElement, tooltipHeightMaximum, tooltipWidthMaximum, tooltipTransition }}>
    .overlay-tooltip-inner {
        pointer-events: none;
    }

    .overlay-tooltip-inner .tooltip-calculations-testing-container {
        position: absolute;
        overflow: hidden;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        pointer-events: none;
        z-index: -2147483648;
    }

    .overlay-tooltip-inner .tooltip-outer.tooltip-outer-hidden-for-size-full {
        width: max-content;
        height: max-content;
    }

    .overlay-tooltip-inner .tooltip-space-away-from-trigger-element {
        position: absolute;
        top: 0;
        left: 0;
        width: var(--tooltipSpaceAwayFromTriggerElement);
        height: var(--tooltipSpaceAwayFromTriggerElement);
        min-width: var(--tooltipSpaceAwayFromTriggerElement);
        min-height: var(--tooltipSpaceAwayFromTriggerElement);
        max-width: var(--tooltipSpaceAwayFromTriggerElement);
        max-height: var(--tooltipSpaceAwayFromTriggerElement);
    }

    .overlay-tooltip-inner .tooltip-outer-to-display {
        position: absolute;
        display: none;
        transition: var(--tooltipTransition);
    }

    .overlay-tooltip-inner .tooltip-outer-to-display[data-tooltip-outer-placement] {
        display: block;
    }
    
    .overlay-tooltip-inner .tooltip-outer-to-display .tooltip {
        pointer-events: auto;
    }

    .overlay-tooltip-inner .tooltip {
        margin: var(--tooltipMargin);
        padding: var(--tooltipPadding);
        background-color: var(--tooltipBackgroundColor);
        border-width: var(--tooltipBorderWidth);
        border-color: var(--tooltipBorderColor);
        border-radius: var(--tooltipBorderRadius);
        border-style: solid;
        overflow-y: auto;
        max-height: var(--tooltipHeightMaximum);
        max-width: var(--tooltipWidthMaximum);
    }
</style>
